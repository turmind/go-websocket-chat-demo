# 项目结构和组织

## 文件结构

```
.
├── main.go              # 应用入口点和服务器配置
├── chat.go              # WebSocket 连接处理和消息验证
├── redis.go             # Redis 发布/订阅逻辑
├── go.mod               # Go 模块依赖管理
├── README.md            # 项目说明文档
├── Dockerfile           # 容器构建配置
├── docker-compose.yml   # 本地开发环境配置
└── public/              # 静态文件目录 (HTML/CSS/JS)
```

## 代码组织原则

### 单包架构
- 所有 Go 代码位于 `main` 包中
- 适合小型演示项目的简单结构
- 功能按文件分离，职责清晰

### 文件职责分工

#### main.go - 应用启动和配置
- 环境变量读取和默认值设置
- Redis 连接池初始化
- HTTP 服务器和路由配置
- 协程管理和错误处理

#### chat.go - WebSocket 通信层
- WebSocket 连接升级处理
- 消息格式验证和解析
- 连接生命周期管理
- 客户端消息处理逻辑

#### redis.go - 消息中间件层
- Redis 发布/订阅模式实现
- 消息广播和连接管理
- 系统状态消息处理
- 连接池和错误恢复

## 架构模式

### 组件分离
- **redisReceiver**: 负责从 Redis 接收消息并广播到 WebSocket 连接
- **redisWriter**: 负责将 WebSocket 消息发布到 Redis
- **WebSocket Handler**: 处理客户端连接和消息路由

### 并发模型
- 使用 Go 协程实现异步处理
- Channel 用于组件间通信
- 连接池管理 Redis 连接

### 错误处理策略
- 使用 `pkg/errors` 包装错误信息
- 结构化日志记录错误上下文
- 自动重连和故障恢复机制

## 编码规范

### 命名约定
- 使用驼峰命名法 (camelCase)
- 结构体和接口使用 PascalCase
- 常量使用大写字母和下划线

### 注释规范
- 公共函数和类型必须有文档注释
- 注释以函数/类型名开头
- 复杂逻辑添加行内注释

### 代码组织
- 相关功能分组放置
- 全局变量集中声明
- 初始化逻辑放在 `init()` 函数中